Давай сделаем prd для отдельного подпроекта - создания и размещения контента.
Описываю черновик.

План такой:
1. Все изначальные данные по контенту вносятся проект lima в supabase
2. Создаем в VS Code проект на python, который по шагам осуществляет подготовку контента и в заключении export контента в виде, пригодном для размещения на cdn s3
3. План выполнения создадим после утверждения prd
4. На каждом шаге выполнения нужно: создать отдельный md-файл в папке ./docs/steps, описывающий техническую реализацию, реализовать шаг, актуализировать md-файл с описанием файловой структуры этого проекта и readme.md в папке docs (там же и prd).
5. Требования к проекту на python:
   - В python-проекте все зависимости добавляются через файл requirements.txt.
   - Доступы конфигурируем через .env
   - Конфиг делаем в yaml
      - флаги, по которым осуществляется выполнения шагов (шаги в true выполняются при запуске)
      - какие категории обрабатываем по position от и до, либо -1 для всех
      - какие подкатегории обрабатываем по position от и до, либо -1 для всех
      - какие эпизоды обрабатываем по position от и до, либо -1 для всех
      - какие языки обрабатываем - список [ru, en, ...]
      - какими голосами озвучиваем - список id по БД
      - количество потоков, в котором обрабатываем уникальные тройки категория+подкатегория+эпизод
      - сколько эпизодов создаем в подкатегории
      - параметры для предачи в ElevenLabs для озвучки
   - Экспортируемые файлы (озвучка, json сохраняем в подпапку export, если ее нет - создаем)
   - Все промты к LLM оформляем в виде отдельных md файлов в папке ./docs/agents
   - При сохранении json в БД нужно предварительно форматировать его в легко читаемый вид
   - В ходы выполнения программы выводим прогресс с ID потока и ID задачи, информацию об ошибках, затраченное время, прогноз до завершения операции. Кроме вывода в консоль сохраняем лог последнего запуска в файл логов.
   - Для каждого обращения к LLM предусматриваем 3 попытки с паузой 5, затем 10 секунд. В случае ошибки - выводим ошибку, останавливаем выполнение потока.
   - Дополни, если чего-то базового не хватает

Структура данных в supabase:
- Поля в таблице categories:
   - name:string - внутреннее название категории, например, "деньги"
   - localization:json - название на разных языках {"ru": "...", "en": "..."}
   - position:int - номер категории, начиная с 1
- Поля в таблице subcategories:
   - category_id - категория-родитель
   - name:string - внутреннее название подкатегории, например, "богатство"
   - localization:json - отображаемое для пользователей название подкатегории в зависимости от пола и языка {"female":{"title": {"ru": "...", "en": "..."}}, "male": {"title":{"ru": "...", "en": "..."}}}
   - position:int - номер подкатегории, начиная с 1
   - shadow - массив из двух чисел, например [886438,D7A86D]
   - views:int - число просмотров подкатегории
- Поля в таблице episodes:
   - subcategory_id - подкатегория-родитель
   - episode_name:string - внутреннее название, ключевая аффирмация эпизода, например "Я живу в состоянии богатства и внутреннего спокойствия"
   - position:int - номер эпизода, начиная с 1
- Поля в таблице episodes:
   - episode_id - эпизод-родитель
   - version:string - название версии для А/Б тестирования
   - localization:json - отображаемое для пользователей название и текст эпизода в зависимости от пола и языка {"female":{"title": {"ru": "...", "en": "..."}, "script":{"ru": "...", "en": "..."}}, "male": {"title":{"ru": "...", "en": "..."}, "script":{"ru": "...", "en": "..."}}}
   - script:json - текст эпизода с разметкой для озвучки в ElevenLabs в зависимости от пола и языка {"female":{"title": {"ru": "...", "en": "..."}, "script":{"ru": "...", "en": "..."}}, "male": {"title":{"ru": "...", "en": "..."}, "script":{"ru": "...", "en": "..."}}}
- Поля в таблице voices
   - voice_key:string - ключ голоса в ElevenLabs
   - voice_name:string - имя голоса в ElevenLabs
   - name:json - имя голоса у нас в приложении на разных языках {"ru": "...", "en": "..."}
   - sex:string - M - мужчина, W - женщина
   - description:json - описание голоса на разных языках {"ru": "...", "en": "..."}

Шаги по созданию контента:
1. По внутреннему названию категории сделать локализацию. Системный промпт /agents/category.md. В цикле проходим по всем категориям, передаем в chatGPT категорию и класс для response_format, получаем ответ, сохраняем в БД, затирая старые данные.
2. По внутреннему названию категории сделать локализацию. Системный промпт /agents/subcategory.md. В цикле проходим по всем подкатегориям, передаем в chatGPT внутреннее имя категории, внутреннее имя подкатегории и класс для response_format, получаем на выход словарь с переводами, сохраняем в БД, затирая старые данные.
3. Заполняем views у подкатегорий рандомными числами в диапазоне [(10-позиция категории) *200 + (позиция подкатегории-10) *100; (10-позиция категории) *200 + (позиция подкатегории-10) *100 + 1000]
4. Планируем Х эпизодов (Х берем из конфига). С помощью chatGPT подбираем ключевые аффирмации сразу для всех эпизодов, очищаем эпизоды у обрабатываемой подкатегории, сохраняем новые во внутренние имена эпизодов, инкрементально сохраняем позицию эпизодов. Системный промпт /agents/episodes.md. В цикле проходим по всем подкатегориям, передаем в chatGPT внутреннее имя категории, внутреннее имя подкатегории, создаем на лету класс с полями для нужного количества эпизодов для response_format, получаем на выходе эпизоды, удаляем из БД старые эпизоды у подкатегории если были, сохраняем новые в БД.
5. По внутреннему названию эпизода делаем локализацию и пишем сценарии. Системный промпт /agents/episode_text.md. В цикле проходим по всем эпизодам, передаем в chatGPT внутреннее имя категории, внутреннее имя подкатегории, список с названиями всех эпизодов подкатегории, название текущего обрабатываемого эпизода, класс для получения локализации. Получаем, сохраняем.
6. Размечаем тексты эпизодов для озвучки. В цикле проходим по всем эпизодам, передаем в chatGPT локализацию текущего эпизода класс для получения результата с разметкой. Получаем, сохраняем.
7. Выполняем озвучку через ElevenLabs. В цикле проходим по эпизодам и голосам, передаем в ElevenLabs скрипты, получаем обратно результат, из которого достаем файл с разметкой фраз по времени и сам файл с озвучкой. Сохраняем в ./export/audio в формате <id категории>_<id подкатегории>_<id эпизода>_<w/m>_<ru/en/...> и расширение файла.
