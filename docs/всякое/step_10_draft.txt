Шаг 10 "Ежедневные аффирмации"
1. Запускаем цикл по всем записям в таблице affirmations_new
с учетом фильтра в конфиге по категориям/подкатегориям/наставникам/позициям.
Задачи выполняем с учетом нашей стандартной многопоточности.
Результаты лаконично, но наглядно выводим в лог-файл и бизнес-статус в консоль.
2. Проходим по всем разрешенным языкам, проверяем, заполнено ли поле
affirmations_new.allowed_for_daily для языка и обоих полов
3.1. Если нужного пола/языка нет:
Поочереди отпраляем в LLM chatGPT скрипт аффирмации для языка/пола.
Передаем новый промт 10_check_daily_affirmation.md.
В этом промте пишем, чтобы LLM оценила, подходит ли данная аффирмация для
прослушивания утром, днем, перед сном.
Просим вернуть json {"morning":{"suitable":boolean}, "afternoon":{"suitable":boolean}, "night":{"suitable":boolean}}.
На нашей стороне собираем итоговый json с обоими полами и языками.
Дописываем данные в имеющийся json, если мы его дополняем.
Или записываем новый json, если поле было пустым.
3.2. Рисуем изображение.
Повторяем три раза – для утра, дня, ночи.
В случае ошибки делаем ретраи по нашему стандартному механизму.
Проверяем нет ли уже готового файла превью в папке ./export/daily_previews.
Формат имени файла такой же, как на шаге 8 для аудио файлов: например, 8_9_4_3_m_en_<morning/afternoon/evening>.webp.
   a. Если файл есть – пропускаем.
   b. Если файла нет":
      - делаем запрос к chatGPT с просьбой подготовить ТЗ на изображение по новому промту 10_image_task.md,
      плюс передаем текст аффирмации, время суток morning/afternoon/evening, пол юзера female/male.
      На выходе ждем объект
      image_prompt = {
      "prompt": "Один абзац до 300 слов — готовый prompt-ТЗ (не пиши в нем имен других фотографов)"
      "ref": "выбранный референсный стиль и связь композиции с аффирмацией"
      }
      Сохраняем полученный объект в json в поле affirmations_new.allowed_for_daily, например, "morning":{"suitable":true, "image_prompt":"..."} (заменяем, если уже был этот ключ)
      - Отправляем полученные промт в chatGPT с просьбой нарисовать изображение.
      - Полученное изображение перекодируем в webp и сохраняем в ./export/daily_previews с описанным ранее именем файла.
