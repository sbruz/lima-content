# –®–∞–≥ 12: Create a **composite affirmation** for {time_of_day}.


## üéØ –¶–µ–ª—å
Help the person gently shift from inner noise to quiet, embodied direction ‚Äî as if a wise voice had only one moment to speak.

---

## üß© –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –¢–∞–±–ª–∏—Ü–∞ `affirmations_new`, –ø–æ–ª–µ `popular_aff` ‚Äì –≤—Ö–æ–¥–Ω–∞—è –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏—è —Å –≤—ã–±–æ—Ä–æ–º –ø–æ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ –∑–∞–ø–∏—Å–∏, –≥–¥–µ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ). –ü—Ä–∏–º–µ—Ä:
  ```json
  {
    "female": { "EN": "I am a magnet for money. I am paid for my worth." },
    "male":   { "EN": "I am a magnet for money. Money moves to my decisiveness." }
  }
  ```
- –¢–∞–±–ª–∏—Ü–∞ `coaches`, –ø–æ–ª–µ `coach_aff_style`- —Ç–æ–Ω.
- –î–∏–∞–ø–∞–∑–æ–Ω—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±–µ—Ä—ë–º –∏–∑ `config.yaml` (`range.categories`, `range.subcategories`, `range.positions`, `versions`, `languages`).
- –ü—Ä–æ–º–ø—Ç: `docs/agents/coach_aff_style.md`.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã LLM: `gpt-5.1`, `response_schema=CoachAffirmationForTimeOfDay` (–Ω–æ–≤–∞—è Pydantic-—Å—Ö–µ–º–∞, –ª–µ–∂–∏—Ç –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —à–∞–≥–∞ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ `step11_popular_affirmations.py`).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
steps:
  coach_affirmation_for_time_of_day: true   # –Ω–æ–≤—ã–π —Ñ–ª–∞–≥
```
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ retry-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`retry.*`) –∏ –ª–∏–º–∏—Ç—ã (`rate_limits.openai`).
- –Ø–∑—ã–∫–∏ –±–µ—Ä—ë–º —Ä–æ–≤–Ω–æ –∏–∑ `config.languages` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["RU", "EN"]`).

---

## üöÄ –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤ ‚Üí –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—è—è –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏–∑ `config.yaml`.
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –±–µ—Ä—ë–º `affirmations_new.popular_aff`, –ø–∞—Ä—Å–∏–º JSON –≤–∏–¥–∞ `{"female":{"EN":...},"male":...}`, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º `coach_aff_style` –∏–∑ `coaches` –ø–æ `coach_id`.
3. –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —è–∑—ã–∫–∞–º –∏–∑ `config.languages` (–≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä).
4. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–ª–∞ (`female` ‚Üí `male`), —è–∑—ã–∫–∞, –∑–∞–ø–∏—Å–∏, –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è (`morning`, `afternoon`, `late evening`):
   - –õ–æ–≥–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è/–∫–æ—É—á/–ø–æ–∑–∏—Ü–∏—è/–ø–æ–ª/—è–∑—ã–∫).
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ LLM —Å –ø—Ä–æ–º–ø—Ç–æ–º `coach_aff_style.md`, –ø–æ–¥—Å—Ç–∞–≤–ª—è—è –≤–Ω—É—Ç—Ä—å –Ω–µ–≥–æ `{time_of_day}` –∏ `{coach_adjustment}` (–∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `coach_aff_style`).
   - LLM –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∑–≤—É—á–∏—Ç –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è –º–∞–Ω—Ç—Ä–∞.
   - –ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–æ –±–æ–ª—å—à–µ 70 —Å–∏–º–≤–æ–ª–æ–≤ (–¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏) ‚Äî –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫, –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫, –ø—Ä–æ–º–ø—Ç —Ç–æ—Ç –∂–µ). –ü–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á ‚Äî –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –∫—Ä–∞—Å–Ω—ã–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º ID –≤ –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç.
5. –û–±–Ω–æ–≤–ª—è–µ–º `affirmations_new.aff_for_banners`:
   ```json
   {
     "female": {"EN": {"morning":"‚Ä¶", "afternoon":"‚Ä¶", "late evening":"‚Ä¶"}, "RU": {"morning":"‚Ä¶", "afternoon":"‚Ä¶", "late evening":"‚Ä¶"}},
     "male":   {"EN": {"morning":"‚Ä¶", "afternoon":"‚Ä¶", "late evening":"‚Ä¶"}}
   }
   ```
   - –ü–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º JSON, –∑–∞—Ç–∏—Ä–∞—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª–∞ (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å —à–∞–≥–æ–º `step11_popular_affirmations.py`).
6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `affirmations_new.aff_for_banners`. –ñ—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º —É—Å–ø–µ—Ö –∏ –æ—à–∏–±–∫–∏.

---

## üì¶ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–ª–µ `affirmations_new.aff_for_banners`, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –≤–∏—Ä—É—Å–Ω—ã–µ –º–∞–Ω—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª–∞ –∏ —è–∑—ã–∫–∞.

---

## üßæ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
| --- | --- | --- |
| Invalid script JSON | –ü–æ–≤—Ä–µ–∂–¥—ë–Ω `affirmations_new.popular_aff` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å –∏ –∑–∞–ø–∏—Å–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| LLM request failed | –°–µ—Ç–µ–≤—ã–µ/429 | –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ `RetryableStepError` |
| DB update failed | –û—à–∏–±–∫–∞ Supabase | –û–±–µ—Ä–Ω—É—Ç—å –≤ `RetryableStepError`, —á—Ç–æ–±—ã job –ø–æ–≤—Ç–æ—Ä–∏–ª—Å—è |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –î–ª—è –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Å—Ç—Ä–æ–∫–∏ –≤ `aff_for_banners` (–ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —è–∑—ã–∫–∞–º/–ø–æ–ª–∞–º).
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞–≥–ª—è–¥–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å (—á—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å).
- –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ `logs/last_run.log`.
