# –®–∞–≥ 10: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏

## üéØ –¶–µ–ª—å
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ/–¥–Ω–µ–≤–Ω–æ–≥–æ/–Ω–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–≤—å—é.

---

## üß© –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –¢–∞–±–ª–∏—Ü–∞ `affirmations_new`: `id`, `subcategory_id`, `coach_id`, `position`, `script`, `ready_voice`, `duration`, `allowed_for_daily`, `ready_music`.
- –î–∏–∞–ø–∞–∑–æ–Ω—ã –∏–∑ `config.range.*`, —Ñ–∏–ª—å—Ç—Ä –ø–æ `versions` (–∫–æ—É—á–∏) –∏ `languages`.
- –ü–∞–ø–∫–∞ `./export/daily_previews` –¥–ª—è webp-—Ñ–∞–π–ª–æ–≤ –ø—Ä–µ–≤—å—é.
- –ü—Ä–æ–º—Ç—ã:
  - `docs/agents/check_daily_affirmation.md` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç–∏.
  - `docs/agents/image_task.md` ‚Äî –¢–ó –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
- –ú–æ–¥–µ–ª—å –¥–ª—è LLM –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `gpt-5` (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ `ids.daily_model`).
- –ú–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: `gpt-image-1` (`size=1024x1536`, `quality=high`, `format=webp`, `compression=95` ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
steps:
  daily_affirmations: true
threads_daily: 8           # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö —à–∞–≥–æ–≤
```
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `range.categories/subcategories/positions` –∏ `versions`.

---

## üöÄ –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–ø–∏—Å–∏ `affirmations_new` –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º. –ó–∞–¥–∞—á–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ (subcategory √ó coach √ó position √ó language √ó gender) —Å —É—á–µ—Ç–æ–º —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ `allowed_for_daily`.
2. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:
   - –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ `allowed_for_daily` –±–ª–æ–∫ –¥–ª—è gender/lang. –ï—Å–ª–∏ –Ω–µ—Ç:
     1) –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ –≤ LLM (–ø—Ä–æ–º—Ç `check_daily_affirmation.md`, `response_schema=SuitabilityResponse`), –ø–æ–ª—É—á–∞–µ–º JSON –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫.
     2) –î–æ–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `allowed_for_daily` (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è).
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ (`morning`, `afternoon`, `night`):
     - –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ webp-—Ñ–∞–π–ª–∞ `./export/daily_previews/<cat>_<sub>_<coach>_<pos>_<m|w>_<lang>_<time>.webp`. –ï—Å–ª–∏ —Ñ–∞–π–ª –µ—Å—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.
     - –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç:
       1) –í—ã–∑—ã–≤–∞–µ–º LLM —Å –ø—Ä–æ–º—Ç–æ–º `image_task.md` + —Ç–µ–∫—Å—Ç –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ + `time_of_day` + `gender` (`response_schema=ImagePromptResponse`), –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç `image_prompt` (`prompt`, `ref`).
       2) –°–æ—Ö—Ä–∞–Ω—è–µ–º `image_prompt` –≤ `allowed_for_daily` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ (–∑–∞–º–µ–Ω—è–µ–º/–¥–æ–ø–æ–ª–Ω—è–µ–º).
       3) –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenAI Images (`model="gpt-image-1"`, `size="1024x1536"`, `quality="medium"`, `output_format="webp"`, `output_compression=95`; –¥–µ–∫–æ–¥–∏—Ä—É–µ–º `b64_json` –≤ webp-—Ñ–∞–π–ª) –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `docs/openai_images.md`, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º.
3. –õ–æ–≥–∏: –∫–æ—Ä–æ—Ç–∫–∏–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª—å, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã/–æ—à–∏–±–∫–∏ ‚Äî –≤ `logs/last_run.log`.
4. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (–Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—å—é –∏ –¥–∞–Ω–Ω—ã—Ö –≤ `allowed_for_daily`).

---

## üì¶ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –ø–æ–ª–µ `affirmations_new.allowed_for_daily` —Å –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å—é –∏ –¢–ó –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫/–ø–æ–ª—É/—è–∑—ã–∫—É.
- –ü—Ä–µ–≤—å—é-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ `./export/daily_previews/*.webp` –ø–æ –º–∞—Å–∫–µ `<cat>_<sub>_<coach>_<pos>_<m|w>_<lang>_<time>.webp`.

---

## üßæ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
| --- | --- | --- |
| LLM request failed | —Å–µ—Ç–µ–≤–æ–π/429 | –ø–æ–≤—Ç–æ—Ä–∏—Ç—å (—à–∞–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏) |
| OpenAI image 422/400 | —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π prompt –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π payload | —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| File save failed | –Ω–µ—Ç –ø—Ä–∞–≤/–¥–∏—Å–∫ | –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `./export/daily_previews` |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –î–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å (morning/afternoon/night) –≤ `allowed_for_daily`.
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã webp-–ø—Ä–µ–≤—å—é –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π.
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –Ω–µ—Ç.
