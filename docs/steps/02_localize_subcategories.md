# –®–∞–≥ 2: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üéØ –¶–µ–ª—å
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π** –ø–æ –ø–æ–ª—É –∏ —è–∑—ã–∫–∞–º –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Supabase –≤ –ø–æ–ª–µ `subcategories.localization`.
–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø—Ä–∏–º–µ—Ä):
```json
{
  "female": { "title": { "ru": "–ü—Ä–æ—â–µ–Ω–∏–µ —Å–µ–±—è", "en": "Self‚ÄëForgiveness" } },
  "male":   { "title": { "ru": "–ü—Ä–æ—â–µ–Ω–∏–µ —Å–µ–±—è", "en": "Self‚ÄëForgiveness" } }
}
```

> **Pydantic:** –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ Pydantic-–º–æ–¥–µ–ª–∏. –ù–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ–º —Å—Ö–µ–º—ã –∏–∑ –¥—Ä—É–≥–∏—Ö —à–∞–≥–æ–≤, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.

---

## üß© –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –¢–∞–±–ª–∏—Ü–∞ Supabase: `categories`
  - –ü–æ–ª—è:
    - `id`
    - `name` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–¥–µ–Ω—å–≥–∏", "self love")
    - `localization`
    - `position` ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –¢–∞–±–ª–∏—Ü–∞ Supabase: **`subcategories`**
  - –ü–æ–ª—è:
    - `id`
    - `category_id` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    - `name` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∏–º—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `self_forgiveness` / ¬´–±–æ–≥–∞—Ç—Å—Ç–≤–æ¬ª)
    - `localization` ‚Äî **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** —ç—Ç–∏–º —à–∞–≥–æ–º (–¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
    - `ready` ‚Äî —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —à–∞–≥–∞ 2 (`READY`, `CHECK`, `NULL` –∏ —Ç.–¥.)
    - `position`, `shadow_w`, `shadow_m`, `views` ‚Äî **–Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è** –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ
- –î–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ LLM –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë–º **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–í–∫–ª—é—á–µ–Ω–∏–µ —à–∞–≥–∞ –≤ `config.yaml`:
```yaml
steps:
  localize_subcategories: true
```
–î–∏–∞–ø–∞–∑–æ–Ω—ã –∏ –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
```yaml
range:
  categories: [1, -1]
  subcategories: [1, -1]
languages: [ru, en]
threads: 4
```

> –û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–≥–∞ 2 –¥–æ–ø—É—Å–∫–∞–µ—Ç **–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**. –ö–∞—Ä–∫–∞—Å ‚Äî –∏–∑ –®–∞–≥–∞ 0.

> **–°—Ç–∞—Ç—É—Å `ready`:** –µ—Å–ª–∏ —É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–º–µ—é—Ç `ready = "READY"`, —à–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞ `READY`, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–æ–ª–µ `ready` –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ `CHECK`.

---

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
- C—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—è `localization` –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å **–æ–±–∞ –ø–æ–ª–∞** (`female`, `male`).
- –í –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–≤—Å–µ —è–∑—ã–∫–∏** –∏–∑ `config.yaml > languages`.
- –ü–æ–ª–µ **—Ç–æ–ª—å–∫–æ `title`**.
- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `READY` –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π; –¥–ª—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `CHECK`.
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–µ–∑ `READY`.

---

## üß† –ü—Ä–æ–º–ø—Ç LLM
–í —Ñ–∞–π–ª–µ `docs/agents/subcategory.md`

---

## üßæ –í—ã–∑–æ–≤–∞ LLM
–ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ —Å–¥–µ–ª–∞–Ω–Ω—É—é –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π —Å–≤–æ–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.
–°–æ–∑–¥–∞–≤–∞–π —Å–≤–æ–∏ pydantic –∫–ª–∞—Å—Å—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞.

---

## üß± –û–±—Ö–æ–¥ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –∑–∞–ø–∏—Å—å –≤ –ë–î
–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ chatGPT —Å—Ä–∞–∑—É –≤—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
–î–ª—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥–∞–µ–º pydantic –∫–ª–∞—Å—Å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–µ–±—É–µ–º–æ–º—É.
–í –ø–æ–ª—É—á–∞–µ–º–æ–º –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π.
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –ë–î, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

> –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ **—Ä–µ—Ç—Ä–∞–∏** –∏ **rate-limit** –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–∞—Ä–∫–∞—Å–∞ (–®–∞–≥ 0).

---

## üß™ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- JSON –≤–∞–ª–∏–¥–µ–Ω, –∫–ª—é—á–∏ `female`/`male` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
- –í—Å–µ —è–∑—ã–∫–∏ –∏–∑ `config.yaml > languages` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `title`.
- –ó–Ω–∞—á–µ–Ω–∏—è ‚Äî **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ‚Äútitle‚Äù**, –∞ –Ω–µ –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
- –í—Å—Ç–∞–≤–∫–∞ –≤ –ë–î –ø—Ä–æ—à–ª–∞ –±–µ–∑ –æ—à–∏–±–æ–∫.

---

## üßæ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ª–æ–≥–∏—Ä—É–µ–º: `category_id`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `subcategory_id`, `duration_ms`, `status`.
- –í –∫–æ–Ω—Ü–µ —à–∞–≥–∞ ‚Äî —Å–≤–æ–¥–∫–∞: `processed`, `failed`, `skipped`, `eta`, `avg_latency`.
- –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –∏ —Å–µ—Ç–µ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–¥ —Ä–µ—Ç—Ä–∞–∏; –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ ‚Äî –∫–∞–∫ `FatalStepError` (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤).

---

## üí• –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---|---|---|
| `Invalid JSON` | LLM –≤–µ—Ä–Ω—É–ª –ª–∏—à–Ω–∏–π —Ç–µ–∫—Å—Ç/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –£–∂–µ—Å—Ç–æ—á–∏—Ç—å –ø—Ä–æ–º–ø—Ç, –≤–∫–ª—é—á–∏—Ç—å `response_format=json_object`, —Ä–µ—Ç—Ä–∞–π |
| `Missing gender key` | –ù–µ—Ç `female`/`male` | –í–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí FatalStepError |
| `Missing language` | –ù–µ—Ç `ru`/`en` –≤ `title` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–∏–≤ `config.yaml > languages` |
| `Supabase update failed` | –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è/–ø—Ä–∞–≤ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `.env`, –ø—Ä–∞–≤–∞ service role |
| `Rate limit` | –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –∫–≤–æ—Ç API | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `rate_limits` + –¥–∂–∏—Ç—Ç–µ—Ä + —É–º–µ–Ω—å—à–∏—Ç—å `threads` |

---

## üß∞ –¢–µ—Å—Ç/–ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–≥–∞ (—á–µ–∫-–ª–∏—Å—Ç)
- [ ] –ü—É—Å—Ç–æ–π –ø—Ä–æ–≥–æ–Ω `--dry-run` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ payload –∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
- [ ] –ü—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–ª–µ `localization` —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- [ ] –ù–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ `range.subcategories` —à–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç ETA –∏ –∏—Ç–æ–≥–æ–≤—É—é —Å–≤–æ–¥–∫—É
- [ ] –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ `steps.localize_subcategories=false` —à–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

---

## üì¶ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ `subcategories.localization` –≤–æ –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö.
- –õ–æ–≥ `./logs/last_run.log` —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –æ—à–∏–±–æ–∫.
- –î–æ–ø–∏—à–∏ –≤ –∫–æ–Ω–µ—Ü —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –æ—Ç—á—ë—Ç –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–∏—Ñ—Ñ–æ–≤.
