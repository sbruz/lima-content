# –®–∞–≥ 6: –û–∑–≤—É—á–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (ElevenLabs)

## üéØ –¶–µ–ª—å
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ-–æ–∑–≤—É—á–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π —á–µ—Ä–µ–∑ ElevenLabs, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å mp3 –∏ —Ç–∞–π–º–∏–Ω–≥–∏ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ –∑–∞–ø–∏—Å–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ Supabase.

---

## üß© –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –¢–∞–±–ª–∏—Ü–∞ `categories`: `id`, `position` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞.
- –¢–∞–±–ª–∏—Ü–∞ `subcategories`: `id`, `category_id`, `position`.
- –¢–∞–±–ª–∏—Ü–∞ `coaches`: `id`, `coach`, `voice_EL_ID` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥–æ–ª–æ—Å–∞ ElevenLabs.
- –¢–∞–±–ª–∏—Ü–∞ `affirmations_new`: `id`, `subcategory_id`, `coach_id`, `position`, `script`, `duration`, `ready_voice`.

> **–í–∞–∂–Ω–æ:** `voice_EL_ID` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞ –∏–∑ `config.versions`. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è —à–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
steps:
  generate_audio: true

range:
  categories: [1, -1]
  subcategories: [1, -1]
  positions: [1, -1]

languages: [RU, EN, ...]    # —Å–ø–∏—Å–æ–∫ ISO 639-1 –∫–æ–¥–æ–≤ (2 –±—É–∫–≤—ã)
versions: [Roxie, Goddard]
threads: 8
threads_audio: 10   # –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è —à–∞–≥–∞ generate_audio
```
- `range.positions` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `affirmations_new`.
- –Ø–∑—ã–∫–∏ –±–µ—Ä—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `config.languages` (–æ–∂–∏–¥–∞—é—Ç—Å—è ISO 639-1 –∫–æ–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä `ru`, `en`).

---

## üöÄ –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
1. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç—Ä–µ–Ω–µ—Ä–æ–≤ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –∏ –ø–æ —Å–ø–∏—Å–∫—É `config.versions`.
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ `affirmations_new` (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º) —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤–∏–¥–∞: `category √ó subcategory √ó coach √ó position √ó language`.
3. –í–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≥–Ω–∞—Ç—å –æ–±–∞ –ø–æ–ª–∞ (`female` => `w`, `male` => `m`). –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –±–µ–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è –≤ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ.
4. –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω—É–ª—è–µ–º –ø–æ–ª–µ `affirmations_new.duration` (`{}`), –∑–∞—Ç–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≥–æ—Ç–æ–≤–æ–π –æ–∑–≤—É—á–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º `{"<filename>": seconds}`.
5. –ó–∞–ø—Ä–æ—Å –≤ ElevenLabs –≤—ã–ø–æ–ª–Ω—è–µ–º —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK:
   - `from elevenlabs.client import ElevenLabs`
   - `response = client.text_to_speech.convert_with_timestamps(...)`
   - `model_id = "eleven_v3"`, `language_code` ‚Äî –∫–æ–¥ —è–∑—ã–∫–∞ (–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä), `voice_id` ‚Äî `coaches.voice_EL_ID`, `voice_settings.stability = 0.5`.
6. –ï—Å–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º–∏–Ω—É—Ç, —Å—á–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º `RetryableStepError`, —á—Ç–æ–±—ã –¥–∂–æ–±–∞ —É—à–ª–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø–æ–ø—ã—Ç–∫—É.
7. –í –æ—Ç–≤–µ—Ç–µ –±–µ—Ä—ë–º `audio_base64` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º `*.mp3`; —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–π–º–∏–Ω–≥–æ–≤ (alignment/timestamps) —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ `*.json`.
8. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≤ `ready_voice` (–¥–æ–±–∞–≤–ª—è–µ–º —è–∑—ã–∫ –≤ —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª–∞), —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.
9. –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤: `./export/audio/<cat_pos>_<sub_pos>_<position>_<m|w>_<lang>_ts<unix>.mp3` –∏ `.json`. –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º.
10. –í –∫–æ–Ω—Å–æ–ª—å –≤—ã–≤–æ–¥–∏–º –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å `[BUSINESS] audio ...`, –≤ —Ñ–∞–π–ª `last_run.log` –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–ª–Ω—ã–µ payload/–æ—à–∏–±–∫–∏.
11. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `LIMA_TTS_PREVIEW=1`, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ `elevenlabs.play.play` ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üì¶ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ö–∞—Ç–∞–ª–æ–≥ `./export/audio` —Å –ø–∞—Ä–∞–º–∏ mp3/json –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏.
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –ø–æ–ª–µ `affirmations_new.duration` —Å–æ —Å–ª–æ–≤–∞—Ä—ë–º `{filename: duration_sec}`.
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –ø–æ–ª–µ `affirmations_new.ready_voice` —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ –≥–æ—Ç–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–¥–∞—á).
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª–∏: —Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ/–æ—Å—Ç–∞–ª–æ—Å—å, ETA.
- `logs/last_run.log` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (payload, –æ—Ç–≤–µ—Ç ElevenLabs, —Ä–µ—Ç—Ä–∞–∏).

---

## üßæ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –î–µ–π—Å—Ç–≤–∏—è |
|--------|---------|----------|
| `FatalStepError: Missing voice_EL_ID` | –¢—Ä–µ–Ω–µ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | –ó–∞–ø–æ–ª–Ω–∏—Ç—å `voice_EL_ID` –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å |
| `RetryableStepError: ElevenLabs request failed` | —Å–µ—Ç–µ–≤–æ–π —Å–±–æ–π/429 –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω —Ç—Ä–µ–∫ >5 –º–∏–Ω—É—Ç | –ø—Ä–æ–≤–µ—Ä—å –∫–≤–æ—Ç—ã, —É–º–µ–Ω—å—à threads, —Å–æ–∫—Ä–∞—Ç–∏ —Ç–µ–∫—Å—Ç/–æ—Ç—Ä–µ–∂—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| `RetryableStepError: Missing script for language` | –Ω–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è | –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥ 5, –ª–∏–±–æ –∏—Å–∫–ª—é—á–∏—Ç—å —è–∑—ã–∫ |
| `FatalStepError: Export directory not writable` | –Ω–µ—Ç –ø—Ä–∞–≤/–ø–∞–ø–∫–∏ | —Å–æ–∑–¥–∞—Ç—å `./export/audio` |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –î–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—Ç mp3/json —Ñ–∞–π–ª—ã –Ω–∞ –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ —è–∑—ã–∫–∏ –∏ –ø–æ–ª—ã (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç).
- `affirmations_new.duration` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –æ—à–∏–±–æ–∫ –Ω–µ—Ç.
